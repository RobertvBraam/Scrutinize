using Domain.UserCases;
using FluentAssertions;
using Integration.Tests.Utils;
using Npm = Vulnerabilities.Npm;
using Nuget = Vulnerabilities.Nuget;

namespace Integration.Tests;

public class VulnerabilityScanningTests
{
    [Fact]
    public void WhenNugetVulnerabilityScanning_ThenReturnListOfVulnerabilities()
    {
        //Arrange
        var vulnerabilityScanning = new Nuget.VulnerabilityScanning(TestAppHelper.IsWindows);
        var sut = new ScanVulnerabilitiesUserCase(vulnerabilityScanning);

        //Act
        var actual = sut.Execute(TestAppHelper.TestAppDirectory);

        //Assert
        actual.HasSucceeded.Should().BeTrue();
        actual.Value.Should().HaveCount(2);
        actual.Value.Should().Contain(vulnerability => vulnerability.DependencyName == "System.Drawing.Common");
    }
    
    [Fact]
    public void WhenNpmVulnerabilityScanning_ThenReturnListOfVulnerabilities()
    {
        //Arrange
        var vulnerabilityScanning = new Npm.VulnerabilityScanning(TestAppHelper.IsWindows);
        var sut = new ScanVulnerabilitiesUserCase(vulnerabilityScanning);

        //Act
        var actual = sut.Execute(TestAppHelper.TestAppDirectory);

        //Assert
        actual.HasSucceeded.Should().BeTrue();
        actual.Value.Should().HaveCount(4);
        actual.Value.Should().Contain(vulnerability => vulnerability.DependencyName == "json5");
    }
}